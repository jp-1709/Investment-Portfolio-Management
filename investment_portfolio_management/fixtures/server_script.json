[
 {
  "allow_guest": 0,
  "api_method": "get_top_asset",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-01-30 10:18:23.650644",
  "module": "Investment Portfolio Management",
  "name": "Get Top Asset",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": null,
  "script": "# Try finding by 'investment' field first\ndata = frappe.db.sql(\"\"\"\n    SELECT investment as name\n    FROM `tabInvestment Ledger Entry`\n    GROUP BY investment\n    ORDER BY SUM(debit_amount) DESC\n    LIMIT 1\n\"\"\", as_dict=True)\n\n# If that failed, try 'investment_name' (some versions use this)\nif not data:\n    data = frappe.db.sql(\"\"\"\n        SELECT investment_name as name\n        FROM `tabInvestment Ledger Entry`\n        GROUP BY investment_name\n        ORDER BY SUM(debit_amount) DESC\n        LIMIT 1\n    \"\"\", as_dict=True)\n\nif data and data[0].name:\n    frappe.response['message'] = data[0].name\nelse:\n    # This helps us see if the table itself is empty or unreachable\n    count = frappe.db.count(\"Investment Ledger Entry\")\n    frappe.response['message'] = f\"No Data (Total Rows: {count})\"",
  "script_type": "API"
 }
]